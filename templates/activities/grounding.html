{% extends "base.html" %}

{% block title %}5-4-3-2-1 Grounding Exercise - Mind Mend{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header bg-info">
                    <h3 class="mb-0 text-dark"><i class="fas fa-hand-holding-heart me-2"></i>5-4-3-2-1 Grounding Exercise</h3>
                </div>
                <div class="card-body">
                    <div class="mb-4">
                        <p class="lead">This grounding technique helps you reconnect with the present moment and reduce anxiety by engaging all your senses.</p>
                        <div class="alert alert-info">
                            <i class="fas fa-clock me-2"></i><strong>Duration:</strong> 5-10 minutes
                        </div>
                    </div>

                    <!-- Progress Tracker -->
                    <div class="mb-4">
                        <div class="progress" style="height: 30px;">
                            <div id="progressBar" class="progress-bar bg-info" role="progressbar" style="width: 0%;">
                                Step 0/5
                            </div>
                        </div>
                    </div>

                    <!-- Exercise Steps -->
                    <div id="exerciseContent">
                        <!-- Step 1: Introduction -->
                        <div class="exercise-step" id="step0">
                            <h4>Welcome to the 5-4-3-2-1 Grounding Exercise</h4>
                            <p>This exercise will help you anchor yourself in the present moment by systematically noticing things through your senses.</p>
                            <p>Find a comfortable position where you can look around freely. Take a deep breath, and when you're ready, click begin.</p>
                            <button class="btn btn-primary" onclick="nextStep()">
                                <i class="fas fa-play me-2"></i>Begin Exercise
                            </button>
                        </div>

                        <!-- Step 2: See -->
                        <div class="exercise-step d-none" id="step1">
                            <h4><i class="fas fa-eye me-2"></i>Step 1: Notice 5 Things You Can See</h4>
                            <p>Look around and identify 5 things you can see. They can be anything - a plant, a picture, the texture of the wall, a shadow, or a color.</p>
                            <div class="form-group mt-3">
                                <label>List what you see (optional):</label>
                                <textarea class="form-control" rows="5" placeholder="1. The blue wall&#10;2. A potted plant&#10;3. Sunlight on the floor&#10;4. My coffee mug&#10;5. A book on the shelf"></textarea>
                            </div>
                            <div class="mt-3">
                                <button class="btn btn-secondary" onclick="previousStep()">Back</button>
                                <button class="btn btn-primary" onclick="nextStep()">Continue</button>
                            </div>
                        </div>

                        <!-- Step 3: Touch -->
                        <div class="exercise-step d-none" id="step2">
                            <h4><i class="fas fa-hand-paper me-2"></i>Step 2: Notice 4 Things You Can Touch</h4>
                            <p>Notice 4 things you can touch or feel. This might be the texture of your clothing, the surface you're sitting on, the temperature of the air, or the feeling of your feet on the ground.</p>
                            <div class="form-group mt-3">
                                <label>What can you feel? (optional):</label>
                                <textarea class="form-control" rows="4" placeholder="1. The soft fabric of my shirt&#10;2. The cool air from the window&#10;3. The smooth surface of my phone&#10;4. The carpet under my feet"></textarea>
                            </div>
                            <div class="mt-3">
                                <button class="btn btn-secondary" onclick="previousStep()">Back</button>
                                <button class="btn btn-primary" onclick="nextStep()">Continue</button>
                            </div>
                        </div>

                        <!-- Step 4: Hear -->
                        <div class="exercise-step d-none" id="step3">
                            <h4><i class="fas fa-volume-up me-2"></i>Step 3: Notice 3 Things You Can Hear</h4>
                            <p>Listen carefully and identify 3 things you can hear. This might include distant traffic, birds chirping, the hum of electronics, or your own breathing.</p>
                            <div class="form-group mt-3">
                                <label>What sounds do you notice? (optional):</label>
                                <textarea class="form-control" rows="3" placeholder="1. The fan humming&#10;2. Birds outside&#10;3. My own breathing"></textarea>
                            </div>
                            <div class="mt-3">
                                <button class="btn btn-secondary" onclick="previousStep()">Back</button>
                                <button class="btn btn-primary" onclick="nextStep()">Continue</button>
                            </div>
                        </div>

                        <!-- Step 5: Smell -->
                        <div class="exercise-step d-none" id="step4">
                            <h4><i class="fas fa-nose me-2"></i>Step 4: Notice 2 Things You Can Smell</h4>
                            <p>Take a moment to notice any scents around you. If you can't smell anything, remember 2 of your favorite scents.</p>
                            <div class="form-group mt-3">
                                <label>What can you smell? (optional):</label>
                                <textarea class="form-control" rows="2" placeholder="1. Fresh coffee&#10;2. Clean laundry"></textarea>
                            </div>
                            <div class="mt-3">
                                <button class="btn btn-secondary" onclick="previousStep()">Back</button>
                                <button class="btn btn-primary" onclick="nextStep()">Continue</button>
                            </div>
                        </div>

                        <!-- Step 6: Taste -->
                        <div class="exercise-step d-none" id="step5">
                            <h4><i class="fas fa-cookie-bite me-2"></i>Step 5: Notice 1 Thing You Can Taste</h4>
                            <p>Finally, notice any taste in your mouth. It might be from something you ate or drank earlier, or simply the taste of your own mouth.</p>
                            <div class="form-group mt-3">
                                <label>What can you taste? (optional):</label>
                                <input type="text" class="form-control" placeholder="Mint from toothpaste">
                            </div>
                            <div class="mt-3">
                                <button class="btn btn-secondary" onclick="previousStep()">Back</button>
                                <button class="btn btn-primary" onclick="completeExercise()">Complete Exercise</button>
                            </div>
                        </div>

                        <!-- Completion -->
                        <div class="exercise-step d-none" id="step6">
                            <div class="text-center">
                                <i class="fas fa-check-circle text-success mb-3" style="font-size: 4rem;"></i>
                                <h4>Excellent Work!</h4>
                                <p class="lead">You've successfully completed the 5-4-3-2-1 Grounding Exercise.</p>
                                <p>How do you feel now compared to when you started? Many people find they feel more present, calm, and centered.</p>
                                
                                <div class="mt-4">
                                    <h5>Rate Your Current Anxiety Level:</h5>
                                    <div class="btn-group" role="group">
                                        <button class="btn btn-outline-success" onclick="rateAnxiety(1)">1 - Very Low</button>
                                        <button class="btn btn-outline-success" onclick="rateAnxiety(2)">2</button>
                                        <button class="btn btn-outline-warning" onclick="rateAnxiety(3)">3</button>
                                        <button class="btn btn-outline-warning" onclick="rateAnxiety(4)">4</button>
                                        <button class="btn btn-outline-danger" onclick="rateAnxiety(5)">5 - Very High</button>
                                    </div>
                                </div>
                                
                                <div class="mt-4">
                                    <button class="btn btn-primary" onclick="location.reload()">
                                        <i class="fas fa-redo me-2"></i>Do Again
                                    </button>
                                    <a href="{{ url_for('activities') }}" class="btn btn-secondary">
                                        <i class="fas fa-arrow-left me-2"></i>Back to Activities
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tips Section -->
                    <div class="mt-5">
                        <h5><i class="fas fa-lightbulb me-2"></i>Tips for Success</h5>
                        <ul>
                            <li>Take your time with each step - there's no rush</li>
                            <li>Be specific in your observations</li>
                            <li>If you get distracted, gently bring your attention back</li>
                            <li>Practice this exercise whenever you feel anxious or disconnected</li>
                            <li>The more you practice, the more effective it becomes</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
let currentStep = 0;
const totalSteps = 6;

function updateProgress() {
    const progress = (currentStep / totalSteps) * 100;
    const progressBar = document.getElementById('progressBar');
    progressBar.style.width = progress + '%';
    progressBar.textContent = currentStep === 0 ? 'Step 0/5' : `Step ${currentStep}/5`;
}

function showStep(step) {
    // Hide all steps
    document.querySelectorAll('.exercise-step').forEach(el => {
        el.classList.add('d-none');
    });
    
    // Show current step
    document.getElementById(`step${step}`).classList.remove('d-none');
    
    updateProgress();
}

function nextStep() {
    if (currentStep < totalSteps) {
        currentStep++;
        showStep(currentStep);
    }
}

function previousStep() {
    if (currentStep > 0) {
        currentStep--;
        showStep(currentStep);
    }
}

function completeExercise() {
    currentStep = 6;
    showStep(currentStep);
    
    // Save completion
    fetch('/api/complete_activity', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            activity: 'grounding',
            completed: true
        })
    });
}

function rateAnxiety(level) {
    // Save anxiety rating
    fetch('/api/rate_activity', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            activity: 'grounding',
            anxiety_level: level
        })
    });
    
    // Show feedback
    alert(`Thank you for your feedback! You rated your anxiety as ${level}/5.`);
}

// Initialize
updateProgress();
</script>
{% endblock %}