{% extends "admin/base.html" %}

{% block title %}Research & Dataset Management - Mind Mend Admin{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row mb-4">
        <div class="col-12">
            <h2 class="text-white mb-4">
                <i class="fas fa-microscope me-3"></i>Research & Dataset Management
            </h2>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card glass-card">
                <div class="card-body">
                    <h5 class="card-title text-white-50">Research Papers</h5>
                    <h2 class="text-white">{{ stats.total_papers }}</h2>
                    <small class="text-success">
                        <i class="fas fa-arrow-up me-1"></i>{{ stats.papers_this_month }} this month
                    </small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card glass-card">
                <div class="card-body">
                    <h5 class="card-title text-white-50">Clinical Datasets</h5>
                    <h2 class="text-white">{{ stats.total_datasets }}</h2>
                    <small class="text-info">{{ stats.total_records }} total records</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card glass-card">
                <div class="card-body">
                    <h5 class="card-title text-white-50">Research Insights</h5>
                    <h2 class="text-white">{{ stats.total_insights }}</h2>
                    <small class="text-warning">{{ stats.validated_insights }} validated</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card glass-card">
                <div class="card-body">
                    <h5 class="card-title text-white-50">Active Analyses</h5>
                    <h2 class="text-white">{{ stats.active_analyses }}</h2>
                    <small class="text-primary">{{ stats.completed_today }} completed today</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation Tabs -->
    <ul class="nav nav-tabs mb-4" id="researchTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="papers-tab" data-bs-toggle="tab" data-bs-target="#papers" type="button">
                <i class="fas fa-file-alt me-2"></i>Research Papers
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="datasets-tab" data-bs-toggle="tab" data-bs-target="#datasets" type="button">
                <i class="fas fa-database me-2"></i>Clinical Datasets
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="insights-tab" data-bs-toggle="tab" data-bs-target="#insights" type="button">
                <i class="fas fa-lightbulb me-2"></i>Insights & Analysis
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="import-tab" data-bs-toggle="tab" data-bs-target="#import" type="button">
                <i class="fas fa-upload me-2"></i>Import Data
            </button>
        </li>
    </ul>

    <!-- Tab Content -->
    <div class="tab-content" id="researchTabsContent">
        <!-- Research Papers Tab -->
        <div class="tab-pane fade show active" id="papers" role="tabpanel">
            <div class="card glass-card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0 text-white">Research Papers Library</h5>
                    <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addPaperModal">
                        <i class="fas fa-plus me-2"></i>Add Paper
                    </button>
                </div>
                <div class="card-body">
                    <!-- Search Bar -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <input type="text" class="form-control" id="paperSearch" placeholder="Search papers...">
                        </div>
                        <div class="col-md-3">
                            <select class="form-select" id="categoryFilter">
                                <option value="">All Categories</option>
                                <option value="early_diagnosis">Early Diagnosis</option>
                                <option value="conflict_resolution">Conflict Resolution</option>
                                <option value="therapy_methods">Therapy Methods</option>
                                <option value="clinical_studies">Clinical Studies</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <button class="btn btn-info w-100" onclick="searchPapers()">
                                <i class="fas fa-search me-2"></i>Search
                            </button>
                        </div>
                    </div>

                    <!-- Papers Table -->
                    <div class="table-responsive">
                        <table class="table table-dark table-hover">
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Authors</th>
                                    <th>Category</th>
                                    <th>Date</th>
                                    <th>Relevance</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="papersTableBody">
                                {% for paper in recent_papers %}
                                <tr>
                                    <td>
                                        <div class="text-truncate" style="max-width: 300px;">
                                            {{ paper.title }}
                                        </div>
                                        <small class="text-muted">{{ paper.journal }}</small>
                                    </td>
                                    <td>{{ paper.authors|truncate(50) }}</td>
                                    <td>
                                        <span class="badge bg-info">{{ paper.category }}</span>
                                    </td>
                                    <td>{{ paper.publication_date.strftime('%Y-%m-%d') if paper.publication_date else 'N/A' }}</td>
                                    <td>
                                        <div class="progress" style="height: 20px;">
                                            <div class="progress-bar bg-success" style="width: {{ (paper.relevance_score * 100)|int }}%">
                                                {{ (paper.relevance_score * 100)|int }}%
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <button class="btn btn-sm btn-primary" onclick="viewPaper({{ paper.id }})">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn btn-sm btn-warning" onclick="extractInsights({{ paper.id }})">
                                            <i class="fas fa-brain"></i>
                                        </button>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Clinical Datasets Tab -->
        <div class="tab-pane fade" id="datasets" role="tabpanel">
            <div class="card glass-card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0 text-white">Clinical Datasets</h5>
                    <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addDatasetModal">
                        <i class="fas fa-plus me-2"></i>Add Dataset
                    </button>
                </div>
                <div class="card-body">
                    <div class="row">
                        {% for dataset in recent_datasets %}
                        <div class="col-md-6 mb-3">
                            <div class="card bg-dark border-info">
                                <div class="card-body">
                                    <h5 class="card-title text-white">{{ dataset.name }}</h5>
                                    <p class="card-text text-white-50">{{ dataset.description|truncate(100) }}</p>
                                    <div class="mb-2">
                                        <span class="badge bg-primary me-2">{{ dataset.data_type }}</span>
                                        <span class="badge bg-secondary">{{ dataset.size }} records</span>
                                        <span class="badge bg-success">Quality: {{ (dataset.quality_score * 100)|int }}%</span>
                                    </div>
                                    <div class="d-flex gap-2">
                                        <button class="btn btn-sm btn-info" onclick="viewDataset({{ dataset.id }})">
                                            <i class="fas fa-chart-bar me-1"></i>View
                                        </button>
                                        <button class="btn btn-sm btn-warning" onclick="analyzeDataset({{ dataset.id }})">
                                            <i class="fas fa-analytics me-1"></i>Analyze
                                        </button>
                                        <button class="btn btn-sm btn-success" onclick="downloadDataset({{ dataset.id }})">
                                            <i class="fas fa-download me-1"></i>Export
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Insights & Analysis Tab -->
        <div class="tab-pane fade" id="insights" role="tabpanel">
            <div class="card glass-card">
                <div class="card-header">
                    <h5 class="mb-0 text-white">Research Insights & Clinical Findings</h5>
                </div>
                <div class="card-body">
                    <!-- Insight Categories -->
                    <div class="row mb-4">
                        <div class="col-md-4">
                            <div class="card bg-dark border-warning">
                                <div class="card-body">
                                    <h6 class="text-warning">Early Diagnosis Markers</h6>
                                    <ul class="list-unstyled text-white-50">
                                        {% for marker in early_diagnosis_markers[:3] %}
                                        <li>
                                            <i class="fas fa-check-circle text-success me-2"></i>
                                            {{ marker.title }}
                                        </li>
                                        {% endfor %}
                                    </ul>
                                    <button class="btn btn-sm btn-warning" onclick="viewInsightCategory('diagnostic_marker')">
                                        View All
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card bg-dark border-info">
                                <div class="card-body">
                                    <h6 class="text-info">Conflict Resolution Strategies</h6>
                                    <ul class="list-unstyled text-white-50">
                                        {% for strategy in conflict_strategies[:3] %}
                                        <li>
                                            <i class="fas fa-handshake text-info me-2"></i>
                                            {{ strategy.title }}
                                        </li>
                                        {% endfor %}
                                    </ul>
                                    <button class="btn btn-sm btn-info" onclick="viewInsightCategory('intervention')">
                                        View All
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card bg-dark border-success">
                                <div class="card-body">
                                    <h6 class="text-success">Treatment Effectiveness</h6>
                                    <ul class="list-unstyled text-white-50">
                                        {% for treatment in treatment_insights[:3] %}
                                        <li>
                                            <i class="fas fa-chart-line text-success me-2"></i>
                                            {{ treatment.title }}
                                        </li>
                                        {% endfor %}
                                    </ul>
                                    <button class="btn btn-sm btn-success" onclick="viewInsightCategory('treatment')">
                                        View All
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- AI Analysis Tools -->
                    <div class="card bg-dark">
                        <div class="card-header">
                            <h6 class="mb-0 text-white">AI-Powered Analysis Tools</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <button class="btn btn-outline-primary w-100" onclick="runMetaAnalysis()">
                                        <i class="fas fa-project-diagram me-2"></i>
                                        Run Meta-Analysis
                                    </button>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <button class="btn btn-outline-warning w-100" onclick="generateClinicalReport()">
                                        <i class="fas fa-file-medical me-2"></i>
                                        Generate Clinical Report
                                    </button>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <button class="btn btn-outline-info w-100" onclick="predictiveModeeling()">
                                        <i class="fas fa-robot me-2"></i>
                                        Predictive Modeling
                                    </button>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <button class="btn btn-outline-success w-100" onclick="correlationAnalysis()">
                                        <i class="fas fa-chart-network me-2"></i>
                                        Correlation Analysis
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Import Data Tab -->
        <div class="tab-pane fade" id="import" role="tabpanel">
            <div class="card glass-card">
                <div class="card-header">
                    <h5 class="mb-0 text-white">Import Research & Datasets</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <!-- Import Research Papers -->
                        <div class="col-md-6">
                            <div class="card bg-dark">
                                <div class="card-body">
                                    <h6 class="text-white mb-3">Import Research Papers</h6>
                                    <form id="importPapersForm">
                                        <div class="mb-3">
                                            <label class="form-label text-white-50">Import Method</label>
                                            <select class="form-select" id="importMethod">
                                                <option value="pubmed">PubMed Search</option>
                                                <option value="doi">DOI Lookup</option>
                                                <option value="pdf">Upload PDF</option>
                                                <option value="bibtex">BibTeX File</option>
                                            </select>
                                        </div>
                                        <div class="mb-3" id="pubmedSearch">
                                            <label class="form-label text-white-50">PubMed Query</label>
                                            <input type="text" class="form-control" placeholder="e.g., anxiety early diagnosis 2020:2024">
                                        </div>
                                        <div class="mb-3 d-none" id="doiInput">
                                            <label class="form-label text-white-50">DOI</label>
                                            <input type="text" class="form-control" placeholder="10.1234/example.doi">
                                        </div>
                                        <div class="mb-3 d-none" id="fileUpload">
                                            <label class="form-label text-white-50">Upload File</label>
                                            <input type="file" class="form-control" accept=".pdf,.bib">
                                        </div>
                                        <button type="submit" class="btn btn-primary w-100">
                                            <i class="fas fa-download me-2"></i>Import Papers
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <!-- Import Datasets -->
                        <div class="col-md-6">
                            <div class="card bg-dark">
                                <div class="card-body">
                                    <h6 class="text-white mb-3">Import Clinical Datasets</h6>
                                    <form id="importDatasetForm">
                                        <div class="mb-3">
                                            <label class="form-label text-white-50">Dataset Name</label>
                                            <input type="text" class="form-control" required>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label text-white-50">Data Type</label>
                                            <select class="form-select">
                                                <option value="behavioral">Behavioral Data</option>
                                                <option value="physiological">Physiological Data</option>
                                                <option value="survey">Survey Responses</option>
                                                <option value="imaging">Brain Imaging</option>
                                                <option value="genetic">Genetic Data</option>
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label text-white-50">Upload Dataset</label>
                                            <input type="file" class="form-control" accept=".csv,.json,.xlsx">
                                        </div>
                                        <div class="mb-3">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="anonymized" checked>
                                                <label class="form-check-label text-white-50" for="anonymized">
                                                    Data is anonymized
                                                </label>
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-success w-100">
                                            <i class="fas fa-database me-2"></i>Import Dataset
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Integration APIs -->
                    <div class="card bg-dark mt-4">
                        <div class="card-header">
                            <h6 class="mb-0 text-white">Research Database Integrations</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="text-center">
                                        <i class="fas fa-book-medical fa-3x text-primary mb-2"></i>
                                        <h6 class="text-white">PubMed</h6>
                                        <span class="badge bg-success">Connected</span>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="text-center">
                                        <i class="fas fa-graduation-cap fa-3x text-info mb-2"></i>
                                        <h6 class="text-white">Google Scholar</h6>
                                        <span class="badge bg-warning">Setup Required</span>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="text-center">
                                        <i class="fas fa-brain fa-3x text-warning mb-2"></i>
                                        <h6 class="text-white">PsycINFO</h6>
                                        <span class="badge bg-danger">Not Connected</span>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="text-center">
                                        <i class="fas fa-microscope fa-3x text-success mb-2"></i>
                                        <h6 class="text-white">ClinicalTrials.gov</h6>
                                        <span class="badge bg-success">Connected</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add Paper Modal -->
<div class="modal fade" id="addPaperModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content bg-dark">
            <div class="modal-header">
                <h5 class="modal-title text-white">Add Research Paper</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="addPaperForm">
                    <div class="mb-3">
                        <label class="form-label text-white-50">Title</label>
                        <input type="text" class="form-control" name="title" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label text-white-50">Authors</label>
                        <input type="text" class="form-control" name="authors" placeholder="John Doe, Jane Smith">
                    </div>
                    <div class="mb-3">
                        <label class="form-label text-white-50">Abstract</label>
                        <textarea class="form-control" name="abstract" rows="4"></textarea>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label text-white-50">Journal</label>
                            <input type="text" class="form-control" name="journal">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label text-white-50">Publication Date</label>
                            <input type="date" class="form-control" name="publication_date">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label text-white-50">DOI</label>
                            <input type="text" class="form-control" name="doi">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label text-white-50">Category</label>
                            <select class="form-select" name="category">
                                <option value="early_diagnosis">Early Diagnosis</option>
                                <option value="conflict_resolution">Conflict Resolution</option>
                                <option value="therapy_methods">Therapy Methods</option>
                                <option value="clinical_studies">Clinical Studies</option>
                            </select>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label text-white-50">Tags (comma-separated)</label>
                        <input type="text" class="form-control" name="tags" placeholder="anxiety, CBT, meta-analysis">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="savePaper()">Save Paper</button>
            </div>
        </div>
    </div>
</div>

<!-- Add Dataset Modal -->
<div class="modal fade" id="addDatasetModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content bg-dark">
            <div class="modal-header">
                <h5 class="modal-title text-white">Add Clinical Dataset</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="addDatasetForm">
                    <div class="mb-3">
                        <label class="form-label text-white-50">Dataset Name</label>
                        <input type="text" class="form-control" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label text-white-50">Description</label>
                        <textarea class="form-control" name="description" rows="3"></textarea>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label text-white-50">Data Type</label>
                            <select class="form-select" name="data_type">
                                <option value="behavioral">Behavioral</option>
                                <option value="physiological">Physiological</option>
                                <option value="survey">Survey</option>
                                <option value="imaging">Imaging</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label text-white-50">Number of Records</label>
                            <input type="number" class="form-control" name="size">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label text-white-50">Institution</label>
                        <input type="text" class="form-control" name="institution">
                    </div>
                    <div class="mb-3">
                        <label class="form-label text-white-50">Ethical Approval Number</label>
                        <input type="text" class="form-control" name="ethical_approval">
                    </div>
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="anonymized" checked>
                            <label class="form-check-label text-white-50">
                                Data is anonymized and HIPAA compliant
                            </label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-success" onclick="saveDataset()">Save Dataset</button>
            </div>
        </div>
    </div>
</div>

<script>
// Research Management JavaScript
function searchPapers() {
    const query = document.getElementById('paperSearch').value;
    const category = document.getElementById('categoryFilter').value;
    
    fetch('/admin/api/search-research', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({query, category})
    })
    .then(response => response.json())
    .then(data => {
        updatePapersTable(data.results);
    });
}

function updatePapersTable(papers) {
    const tbody = document.getElementById('papersTableBody');
    tbody.innerHTML = papers.map(paper => `
        <tr>
            <td>
                <div class="text-truncate" style="max-width: 300px;">
                    ${paper.title}
                </div>
                <small class="text-muted">${paper.journal || ''}</small>
            </td>
            <td>${paper.authors || ''}</td>
            <td><span class="badge bg-info">${paper.category}</span></td>
            <td>${paper.publication_date || 'N/A'}</td>
            <td>
                <div class="progress" style="height: 20px;">
                    <div class="progress-bar bg-success" style="width: ${paper.relevance_score * 100}%">
                        ${Math.round(paper.relevance_score * 100)}%
                    </div>
                </div>
            </td>
            <td>
                <button class="btn btn-sm btn-primary" onclick="viewPaper(${paper.id})">
                    <i class="fas fa-eye"></i>
                </button>
                <button class="btn btn-sm btn-warning" onclick="extractInsights(${paper.id})">
                    <i class="fas fa-brain"></i>
                </button>
            </td>
        </tr>
    `).join('');
}

function savePaper() {
    const form = document.getElementById('addPaperForm');
    const formData = new FormData(form);
    const data = Object.fromEntries(formData);
    data.tags = data.tags.split(',').map(t => t.trim());
    
    fetch('/admin/api/add-research-paper', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showAlert('Research paper added successfully', 'success');
            bootstrap.Modal.getInstance(document.getElementById('addPaperModal')).hide();
            location.reload();
        }
    });
}

function saveDataset() {
    const form = document.getElementById('addDatasetForm');
    const formData = new FormData(form);
    const data = Object.fromEntries(formData);
    data.anonymized = form.anonymized.checked;
    
    fetch('/admin/api/add-clinical-dataset', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showAlert('Clinical dataset added successfully', 'success');
            bootstrap.Modal.getInstance(document.getElementById('addDatasetModal')).hide();
            location.reload();
        }
    });
}

function viewPaper(paperId) {
    window.open(`/admin/research/paper/${paperId}`, '_blank');
}

function extractInsights(paperId) {
    fetch(`/admin/api/extract-insights/${paperId}`, {method: 'POST'})
    .then(response => response.json())
    .then(data => {
        showAlert(`Extracted ${data.insights_count} insights from paper`, 'success');
    });
}

function analyzeDataset(datasetId) {
    fetch(`/admin/api/analyze-dataset/${datasetId}`, {method: 'POST'})
    .then(response => response.json())
    .then(data => {
        showAlert('Dataset analysis completed', 'success');
        window.open(`/admin/research/analysis/${data.analysis_id}`, '_blank');
    });
}

function viewInsightCategory(category) {
    window.location.href = `/admin/research/insights?category=${category}`;
}

function runMetaAnalysis() {
    showAlert('Meta-analysis feature coming soon', 'info');
}

function generateClinicalReport() {
    showAlert('Clinical report generation feature coming soon', 'info');
}

// Import method change handler
document.getElementById('importMethod').addEventListener('change', function() {
    document.querySelectorAll('#pubmedSearch, #doiInput, #fileUpload').forEach(el => {
        el.classList.add('d-none');
    });
    
    switch(this.value) {
        case 'pubmed':
            document.getElementById('pubmedSearch').classList.remove('d-none');
            break;
        case 'doi':
            document.getElementById('doiInput').classList.remove('d-none');
            break;
        case 'pdf':
        case 'bibtex':
            document.getElementById('fileUpload').classList.remove('d-none');
            break;
    }
});

function showAlert(message, type) {
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed top-0 start-50 translate-middle-x mt-3`;
    alertDiv.style.zIndex = '9999';
    alertDiv.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    document.body.appendChild(alertDiv);
    setTimeout(() => alertDiv.remove(), 5000);
}
</script>
{% endblock %}