<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Behavioral Profile - {{ user.name }} - MindMend Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background-color: #f8f9fa; }
        .profile-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }
        .profile-card {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        .insight-box {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-left: 4px solid #667eea;
        }
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
        }
        .metric-label {
            color: #6c757d;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .trend-improving { color: #28a745; }
        .trend-declining { color: #dc3545; }
        .trend-stable { color: #6c757d; }
        .engagement-high { color: #28a745; }
        .engagement-medium { color: #ffc107; }
        .engagement-low { color: #dc3545; }
        .risk-indicator {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 5px;
        }
        .risk-indicator.high {
            background: #f8d7da;
            border-left-color: #dc3545;
        }
        .phi-warning {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 2rem;
        }
        .time-badge {
            background: #667eea;
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            margin: 0.2rem;
            display: inline-block;
        }
        .chart-small {
            height: 200px;
        }
        .avatar-lg {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="profile-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <div class="d-flex align-items-center">
                        <div class="avatar-lg me-3">
                            {{ user.name[0].upper() }}
                        </div>
                        <div>
                            <h1>{{ user.name }}</h1>
                            <p class="mb-0">Behavioral Profile & Insights</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 text-md-end">
                    <div class="text-white-50 small">
                        Member since: {{ user.created_at.strftime('%B %d, %Y') if user.created_at else 'Unknown' }}
                    </div>
                    <div class="text-white">
                        <i class="fas fa-chart-line me-2"></i>{{ sessions_count }} total sessions
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="phi-warning">
            <i class="fas fa-shield-alt me-2"></i>
            <strong>PHI Notice:</strong> This behavioral profile contains Protected Health Information (PHI).
            Access is logged and monitored for HIPAA compliance. Use this information responsibly for patient care purposes only.
        </div>

        {% if profile.message %}
        <div class="alert alert-info">
            <i class="fas fa-info-circle me-2"></i>{{ profile.message }}
        </div>
        {% else %}

        <!-- Key Metrics -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="profile-card text-center">
                    <div class="metric-value">{{ "%.1f"|format(profile.consistency_score) }}%</div>
                    <div class="metric-label">Consistency Score</div>
                    <div class="mt-2">
                        <small class="engagement-{{ 'high' if profile.consistency_score > 60 else 'medium' if profile.consistency_score > 30 else 'low' }}">
                            {{ profile.engagement_level|title }} Engagement
                        </small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="profile-card text-center">
                    <div class="metric-value">{{ "%.1f"|format(profile.session_frequency) }}</div>
                    <div class="metric-label">Sessions/Day</div>
                    <div class="mt-2">
                        <small class="text-muted">
                            <i class="fas fa-clock me-1"></i>{{ "%.1f"|format(profile.avg_session_length) }} min avg
                        </small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="profile-card text-center">
                    <div class="metric-value trend-{{ profile.mood_trend }}">
                        <i class="fas fa-{{ 'arrow-up' if profile.mood_trend == 'improving' else 'arrow-down' if profile.mood_trend == 'declining' else 'minus' }}"></i>
                    </div>
                    <div class="metric-label">Mood Trend</div>
                    <div class="mt-2">
                        <small class="trend-{{ profile.mood_trend }}">
                            {{ profile.mood_trend|title }}
                        </small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="profile-card text-center">
                    <div class="metric-value">{{ profile.total_sessions }}</div>
                    <div class="metric-label">Total Sessions</div>
                    <div class="mt-2">
                        <small class="text-muted">
                            <i class="fas fa-chart-bar me-1"></i>Complete history
                        </small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Behavioral Insights -->
        <div class="row">
            <div class="col-lg-8">
                <div class="profile-card">
                    <h5><i class="fas fa-brain me-2 text-primary"></i>Session Patterns & Preferences</h5>

                    <div class="row">
                        <div class="col-md-6">
                            <h6>Preferred Session Times</h6>
                            {% if profile.preferred_session_times %}
                                {% for hour, count in profile.preferred_session_times.items() %}
                                <span class="time-badge">{{ hour }}:00 ({{ count }}x)</span>
                                {% endfor %}
                            {% else %}
                                <p class="text-muted">No clear pattern identified</p>
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            <h6>Usage Insights</h6>
                            <ul class="list-unstyled">
                                <li><i class="fas fa-calendar me-2 text-primary"></i>
                                    {{ "%.1f"|format(profile.session_frequency) }} sessions per day average
                                </li>
                                <li><i class="fas fa-clock me-2 text-primary"></i>
                                    {{ "%.1f"|format(profile.avg_session_length) }} minute average session length
                                </li>
                                <li><i class="fas fa-chart-line me-2 text-primary"></i>
                                    {{ "%.1f"|format(profile.consistency_score) }}% consistency in usage patterns
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="profile-card">
                    <h5><i class="fas fa-heart me-2 text-danger"></i>Mood & Progress Analysis</h5>

                    <div class="row">
                        <div class="col-md-4">
                            <div class="text-center">
                                <div class="display-4 trend-{{ profile.mood_trend }}">
                                    <i class="fas fa-{{ 'smile' if profile.mood_trend == 'improving' else 'frown' if profile.mood_trend == 'declining' else 'meh' }}"></i>
                                </div>
                                <h6 class="trend-{{ profile.mood_trend }}">{{ profile.mood_trend|title }}</h6>
                                <small class="text-muted">Overall mood trend</small>
                            </div>
                        </div>
                        <div class="col-md-8">
                            <h6>Progress Indicators</h6>
                            <ul class="list-unstyled">
                                <li><i class="fas fa-trend-up me-2 text-success"></i>
                                    Mood pattern shows {{ profile.mood_trend }} trajectory
                                </li>
                                <li><i class="fas fa-target me-2 text-info"></i>
                                    {{ profile.engagement_level|title }} engagement level indicates
                                    {{ 'strong' if profile.engagement_level == 'high' else 'moderate' if profile.engagement_level == 'medium' else 'limited' }}
                                    therapeutic involvement
                                </li>
                                <li><i class="fas fa-calendar-check me-2 text-primary"></i>
                                    {{ "%.1f"|format(profile.consistency_score) }}% consistency suggests
                                    {{ 'excellent' if profile.consistency_score > 70 else 'good' if profile.consistency_score > 40 else 'needs improvement in' }}
                                    routine adherence
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="profile-card">
                    <h5><i class="fas fa-exclamation-triangle me-2 text-warning"></i>Risk Indicators</h5>

                    {% if profile.risk_indicators %}
                        {% for indicator in profile.risk_indicators %}
                        <div class="risk-indicator {{ 'high' if 'Low mood' in indicator or 'crisis' in indicator.lower() else '' }}">
                            <i class="fas fa-{{ 'exclamation-triangle' if 'Low mood' in indicator else 'clock' if 'short' in indicator else 'calendar-times' }}"></i>
                            <strong>{{ indicator }}</strong>
                            <small class="d-block text-muted mt-1">
                                {% if 'Low mood' in indicator %}
                                Requires immediate attention and monitoring
                                {% elif 'short' in indicator %}
                                May indicate disengagement or attention difficulties
                                {% elif 'Irregular' in indicator %}
                                Inconsistent usage may affect therapeutic outcomes
                                {% endif %}
                            </small>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle me-2"></i>
                            No significant risk indicators detected. User shows positive engagement patterns.
                        </div>
                    {% endif %}
                </div>

                <div class="profile-card">
                    <h5><i class="fas fa-lightbulb me-2 text-warning"></i>Recommendations</h5>

                    <div class="insight-box">
                        <h6>Therapeutic Recommendations</h6>
                        <ul class="small mb-0">
                            {% if profile.consistency_score < 40 %}
                            <li>Implement reminder system to improve session consistency</li>
                            <li>Consider flexible scheduling to match user preferences</li>
                            {% endif %}

                            {% if profile.avg_session_length < 10 %}
                            <li>Explore barriers to longer session engagement</li>
                            <li>Consider bite-sized therapy modules</li>
                            {% endif %}

                            {% if profile.mood_trend == 'declining' %}
                            <li>Schedule immediate clinical review</li>
                            <li>Consider crisis intervention protocols</li>
                            {% endif %}

                            {% if profile.engagement_level == 'high' and profile.mood_trend == 'improving' %}
                            <li>Excellent progress - maintain current approach</li>
                            <li>Consider advanced therapeutic modules</li>
                            {% endif %}

                            {% if not profile.risk_indicators %}
                            <li>Stable user - continue current therapeutic plan</li>
                            <li>Consider goal progression opportunities</li>
                            {% endif %}
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Sources -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="profile-card">
                    <h5><i class="fas fa-database me-2 text-info"></i>Data Sources & Analysis Period</h5>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="text-center">
                                <div class="metric-value">{{ sessions_count }}</div>
                                <div class="metric-label">Session Records</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-center">
                                <div class="metric-value">{{ biometric_count }}</div>
                                <div class="metric-label">Biometric Data Points</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-center">
                                <div class="metric-value">100%</div>
                                <div class="metric-label">Analysis Completeness</div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-3">
                        <small class="text-muted">
                            <i class="fas fa-info-circle me-1"></i>
                            This behavioral profile is generated from comprehensive analysis of user interaction patterns,
                            session data, mood tracking, and biometric information where available. Analysis covers
                            the complete user history from account creation to present.
                        </small>
                    </div>
                </div>
            </div>
        </div>

        {% endif %}

        <div class="text-center mt-4 mb-5">
            <a href="{{ url_for('admin.user_detail', user_id=user.id) }}" class="btn btn-primary me-3">
                <i class="fas fa-user me-2"></i>Back to User Profile
            </a>
            <a href="{{ url_for('admin.users_list') }}" class="btn btn-outline-secondary">
                <i class="fas fa-list me-2"></i>Back to User List
            </a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>