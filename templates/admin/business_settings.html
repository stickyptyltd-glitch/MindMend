{% extends "admin/base.html" %}

{% block title %}Business Settings - Mind Mend Admin{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-md-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="fas fa-building"></i> Business Settings</h2>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="saveBusinessSettings()">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                    <a href="{{ url_for('admin.dashboard') }}" class="btn btn-secondary">
                        <i class="fas fa-arrow-left"></i> Back to Dashboard
                    </a>
                </div>
            </div>

            <!-- Business Information -->
            <div class="row">
                <div class="col-md-8">
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5><i class="fas fa-info-circle"></i> Company Information</h5>
                        </div>
                        <div class="card-body">
                            <form id="businessForm">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="companyName" class="form-label">Company Name</label>
                                            <input type="text" class="form-control" id="companyName" 
                                                   value="Sticky Pty Ltd" required>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="businessNumber" class="form-label">Business Number</label>
                                            <input type="text" class="form-control" id="businessNumber" 
                                                   placeholder="ABN/ACN Number">
                                        </div>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="address" class="form-label">Business Address</label>
                                    <textarea class="form-control" id="address" rows="3" required>Suite 329/98-100 Elizabeth Street, Melbourne, VIC, 3000</textarea>
                                </div>

                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="email" class="form-label">Business Email</label>
                                            <input type="email" class="form-control" id="email" 
                                                   value="sticky.pty.ltd@gmail.com" required>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="phone" class="form-label">Business Phone</label>
                                            <input type="tel" class="form-control" id="phone" 
                                                   placeholder="+61 x xxxx xxxx">
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Domain Settings -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5><i class="fas fa-globe"></i> Domain Configuration</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="primaryDomain" class="form-label">Primary Domain</label>
                                <input type="text" class="form-control" id="primaryDomain" 
                                       value="mind-mend.xyz" readonly>
                                <small class="form-text text-muted">
                                    This is your main production domain
                                </small>
                            </div>

                            <div class="mb-3">
                                <label for="secondaryDomains" class="form-label">Secondary Domains</label>
                                <input type="text" class="form-control" id="secondaryDomains" 
                                       value="mindmend.com.au, mindmend.healthcare" readonly>
                                <small class="form-text text-muted">
                                    Additional domains that redirect to primary
                                </small>
                            </div>

                            <div class="alert alert-info">
                                <i class="fas fa-info-circle"></i>
                                <strong>Domain Status:</strong> mind-mend.xyz is ready for deployment configuration
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="col-md-4">
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5><i class="fas fa-chart-bar"></i> Business Overview</h5>
                        </div>
                        <div class="card-body">
                            <div class="stat-item mb-3">
                                <div class="d-flex justify-content-between">
                                    <span>Platform Status</span>
                                    <span class="badge bg-success">Active</span>
                                </div>
                            </div>
                            <div class="stat-item mb-3">
                                <div class="d-flex justify-content-between">
                                    <span>Current Level</span>
                                    <span class="badge bg-primary">Level 2 Enhanced</span>
                                </div>
                            </div>
                            <div class="stat-item mb-3">
                                <div class="d-flex justify-content-between">
                                    <span>Target Market</span>
                                    <span class="text-muted">Australia</span>
                                </div>
                            </div>
                            <div class="stat-item mb-3">
                                <div class="d-flex justify-content-between">
                                    <span>Business Model</span>
                                    <span class="text-muted">SaaS</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- File Upload -->
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="fas fa-upload"></i> Company Documents</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="documentUpload" class="form-label">Upload Business Documents</label>
                                <input type="file" class="form-control" id="documentUpload" 
                                       accept=".pdf,.doc,.docx" multiple>
                                <small class="form-text text-muted">
                                    PDF, DOC, or DOCX files only
                                </small>
                            </div>
                            
                            <div class="existing-documents">
                                <h6>Existing Documents:</h6>
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <span><i class="fas fa-file-pdf text-danger"></i> Company Registration</span>
                                        <button class="btn btn-sm btn-outline-primary" onclick="viewDocument('registration')">View</button>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function saveBusinessSettings() {
    const formData = {
        companyName: document.getElementById('companyName').value,
        businessNumber: document.getElementById('businessNumber').value,
        address: document.getElementById('address').value,
        email: document.getElementById('email').value,
        phone: document.getElementById('phone').value
    };

    fetch('/admin/api/business-settings', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(formData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showAlert('Business settings saved successfully!', 'success');
        } else {
            showAlert('Error saving settings: ' + data.error, 'danger');
        }
    })
    .catch(error => {
        showAlert('Error saving settings: ' + error, 'danger');
    });
}

function viewDocument(docType) {
    // Open document viewer
    window.open('/admin/view-document/' + docType, '_blank');
}

function showAlert(message, type) {
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
    alertDiv.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    const container = document.querySelector('.container-fluid');
    container.insertBefore(alertDiv, container.firstChild);
    
    setTimeout(() => {
        alertDiv.remove();
    }, 5000);
}

// Handle file upload
document.getElementById('documentUpload').addEventListener('change', function(e) {
    const files = e.target.files;
    if (files.length > 0) {
        uploadDocuments(files);
    }
});

function uploadDocuments(files) {
    const formData = new FormData();
    for (let i = 0; i < files.length; i++) {
        formData.append('documents', files[i]);
    }

    fetch('/admin/api/upload-documents', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showAlert('Documents uploaded successfully!', 'success');
            location.reload(); // Refresh to show new documents
        } else {
            showAlert('Error uploading documents: ' + data.error, 'danger');
        }
    })
    .catch(error => {
        showAlert('Error uploading documents: ' + error, 'danger');
    });
}
</script>
{% endblock %}