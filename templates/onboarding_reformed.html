{% extends "base.html" %}

{% block title %}Welcome to MindMend - Let's Get Started{% endblock %}

{% block content %}
<div class="modern-onboarding">
    <!-- Progress Indicator -->
    <div class="progress-header">
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-info">
                <span class="step-counter" id="stepCounter">1 of 5</span>
                <span class="estimated-time">~3 min</span>
            </div>
        </div>
        <button class="skip-button" onclick="skipOnboarding()">Skip Setup</button>
    </div>

    <!-- Onboarding Steps -->
    <div class="onboarding-content" id="onboardingContent">
        
        <!-- Step 1: Welcome & Quick Overview -->
        <div class="step-panel active" data-step="1">
            <div class="step-header">
                <div class="welcome-illustration">
                    <div class="floating-emoji">üß†</div>
                    <div class="floating-emoji delayed">üíö</div>
                    <div class="floating-emoji extra-delayed">‚ú®</div>
                </div>
                <h1>Welcome to MindMend</h1>
                <p class="subtitle">AI-powered mental health support, available 24/7</p>
            </div>
            <div class="quick-features">
                <div class="feature-item">
                    <div class="feature-icon">ü§ñ</div>
                    <span>Expert AI Therapists</span>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">üîí</div>
                    <span>100% Private & Secure</span>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">‚ö°</div>
                    <span>Instant Support</span>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">üì±</div>
                    <span>Works Everywhere</span>
                </div>
            </div>
        </div>

        <!-- Step 2: Choose Your Focus -->
        <div class="step-panel" data-step="2">
            <div class="step-header">
                <h2>What brings you here today?</h2>
                <p>Help us personalize your experience</p>
            </div>
            <div class="focus-grid">
                <div class="focus-card" data-focus="anxiety">
                    <div class="focus-icon">üò∞</div>
                    <h3>Anxiety & Stress</h3>
                    <p>Feeling overwhelmed, worried, or stressed</p>
                </div>
                <div class="focus-card" data-focus="depression">
                    <div class="focus-icon">üò¢</div>
                    <h3>Depression & Mood</h3>
                    <p>Feeling down, unmotivated, or empty</p>
                </div>
                <div class="focus-card" data-focus="relationships">
                    <div class="focus-icon">üíî</div>
                    <h3>Relationships</h3>
                    <p>Couple issues or social difficulties</p>
                </div>
                <div class="focus-card" data-focus="trauma">
                    <div class="focus-icon">‚ö°</div>
                    <h3>Trauma & PTSD</h3>
                    <p>Processing difficult experiences</p>
                </div>
                <div class="focus-card" data-focus="general">
                    <div class="focus-icon">üå±</div>
                    <h3>General Wellness</h3>
                    <p>Self-improvement and mental fitness</p>
                </div>
                <div class="focus-card" data-focus="crisis">
                    <div class="focus-icon">üö®</div>
                    <h3>Crisis Support</h3>
                    <p>Need immediate help right now</p>
                </div>
            </div>
        </div>

        <!-- Step 3: Preferred Session Type -->
        <div class="step-panel" data-step="3">
            <div class="step-header">
                <h2>How would you like to get help?</h2>
                <p>Choose your preferred therapy format</p>
            </div>
            <div class="session-options">
                <div class="session-option" data-session="individual">
                    <div class="session-visual">
                        <div class="person-icon solo">üë§</div>
                    </div>
                    <div class="session-details">
                        <h3>Individual Therapy</h3>
                        <p>Private one-on-one sessions with AI therapists</p>
                        <div class="session-features">
                            <span class="feature-tag">Most Popular</span>
                            <span class="feature-tag">Personalized</span>
                        </div>
                    </div>
                </div>
                <div class="session-option" data-session="couples">
                    <div class="session-visual">
                        <div class="person-icon duo">üë•</div>
                    </div>
                    <div class="session-details">
                        <h3>Couples Therapy</h3>
                        <p>Relationship counseling for you and your partner</p>
                        <div class="session-features">
                            <span class="feature-tag">Relationship Focus</span>
                        </div>
                    </div>
                </div>
                <div class="session-option" data-session="group">
                    <div class="session-visual">
                        <div class="person-icon group">üë•</div>
                    </div>
                    <div class="session-details">
                        <h3>Group Support</h3>
                        <p>Connect with others in supportive group sessions</p>
                        <div class="session-features">
                            <span class="feature-tag">Community</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 4: AI Therapist Matching -->
        <div class="step-panel" data-step="4">
            <div class="step-header">
                <h2>Meet Your AI Therapist</h2>
                <p>We'll match you with the best AI therapist for your needs</p>
            </div>
            <div class="therapist-matching">
                <div class="matching-animation" id="matchingAnimation">
                    <div class="matching-spinner">
                        <div class="spinner-ring"></div>
                        <div class="matching-icon">üîç</div>
                    </div>
                    <div class="matching-text">
                        <h3 id="matchingText">Analyzing your preferences...</h3>
                        <p id="matchingSubtext">Finding your perfect AI therapist match</p>
                    </div>
                </div>
                <div class="therapist-result" id="therapistResult" style="display: none;">
                    <div class="therapist-card matched">
                        <div class="therapist-avatar">
                            <img src="/static/images/ai-therapist.png" alt="AI Therapist" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                            <div class="avatar-fallback">ü§ñ</div>
                        </div>
                        <div class="therapist-info">
                            <h3 id="therapistName">Dr. Maya Chen</h3>
                            <p id="therapistSpecialty">Cognitive Behavioral Therapy Specialist</p>
                            <div class="match-score">
                                <div class="match-percentage">95% Match</div>
                                <div class="match-reasons" id="matchReasons">
                                    <span>Specializes in anxiety</span>
                                    <span>CBT approach</span>
                                    <span>Individual therapy expert</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 5: Ready to Start -->
        <div class="step-panel" data-step="5">
            <div class="step-header">
                <div class="success-icon">üéâ</div>
                <h2>You're All Set!</h2>
                <p>Your personalized MindMend experience is ready</p>
            </div>
            <div class="setup-summary" id="setupSummary">
                <div class="summary-card">
                    <h3>Your Setup:</h3>
                    <div class="summary-items">
                        <div class="summary-item">
                            <span class="summary-label">Focus:</span>
                            <span class="summary-value" id="selectedFocus">Anxiety & Stress</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Session Type:</span>
                            <span class="summary-value" id="selectedSession">Individual Therapy</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">AI Therapist:</span>
                            <span class="summary-value" id="selectedTherapist">Dr. Maya Chen</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="start-options">
                <button class="start-button primary" onclick="startFirstSession()">
                    <span class="button-icon">üöÄ</span>
                    Start My First Session
                </button>
                <button class="start-button secondary" onclick="takeTour()">
                    <span class="button-icon">üëã</span>
                    Take a Quick Tour First
                </button>
            </div>
        </div>
    </div>

    <!-- Navigation Controls -->
    <div class="navigation-controls">
        <button class="nav-btn secondary" id="backButton" onclick="previousStep()" disabled>
            <span>‚Üê Back</span>
        </button>
        <button class="nav-btn primary" id="nextButton" onclick="nextStep()">
            <span>Continue ‚Üí</span>
        </button>
    </div>

    <!-- Quick Help -->
    <div class="quick-help">
        <button class="help-button" onclick="toggleHelp()">
            <span class="help-icon">?</span>
        </button>
        <div class="help-tooltip" id="helpTooltip">
            <p>Need help? Use arrow keys to navigate or click "Skip Setup" to go directly to the platform.</p>
        </div>
    </div>

    <!-- Crisis Support (Always Visible) -->
    <div class="crisis-banner">
        <span class="crisis-text">In crisis? Get immediate help:</span>
        <a href="tel:988" class="crisis-link">Call 988</a>
        <a href="#" class="crisis-link" onclick="showCrisisModal()">Chat Now</a>
    </div>
</div>
{% endblock %}

{% block styles %}
<style>
/* Modern Onboarding Styles */
.modern-onboarding {
    min-height: 100vh;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    position: relative;
    display: flex;
    flex-direction: column;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

/* Progress Header */
.progress-header {
    position: sticky;
    top: 0;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    padding: 1rem 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    z-index: 100;
}

.progress-container {
    flex: 1;
    max-width: 400px;
    display: flex;
    align-items: center;
    gap: 1rem;
}

.progress-bar {
    flex: 1;
    height: 8px;
    background: rgba(102, 126, 234, 0.2);
    border-radius: 10px;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #667eea, #764ba2);
    border-radius: 10px;
    transition: width 0.6s ease;
    width: 20%;
}

.progress-info {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-size: 0.875rem;
    color: #666;
}

.step-counter {
    font-weight: 600;
    color: #333;
}

.estimated-time {
    font-size: 0.75rem;
    opacity: 0.7;
}

.skip-button {
    background: none;
    border: 2px solid #ddd;
    color: #666;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
}

.skip-button:hover {
    border-color: #667eea;
    color: #667eea;
}

/* Main Content */
.onboarding-content {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2rem;
    position: relative;
}

.step-panel {
    display: none;
    max-width: 800px;
    width: 100%;
    animation: slideIn 0.5s ease;
}

.step-panel.active {
    display: block;
}

.step-header {
    text-align: center;
    margin-bottom: 2rem;
    color: white;
}

.step-header h1 {
    font-size: 3rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
    background: linear-gradient(45deg, #fff, #f0f8ff);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.step-header h2 {
    font-size: 2.5rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: white;
}

.step-header p,
.subtitle {
    font-size: 1.2rem;
    color: rgba(255, 255, 255, 0.9);
    margin-bottom: 0;
}

/* Welcome Animations */
.welcome-illustration {
    margin-bottom: 2rem;
    position: relative;
    height: 100px;
}

.floating-emoji {
    position: absolute;
    font-size: 3rem;
    animation: float 3s ease-in-out infinite;
}

.floating-emoji:nth-child(1) {
    left: 50%;
    transform: translateX(-50%);
    animation-delay: 0s;
}

.floating-emoji:nth-child(2) {
    left: 30%;
    animation-delay: 1s;
}

.floating-emoji:nth-child(3) {
    right: 30%;
    animation-delay: 2s;
}

.quick-features {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 1rem;
    margin-top: 2rem;
}

.feature-item {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 15px;
    padding: 1.5rem;
    text-align: center;
    color: white;
    transition: all 0.3s ease;
}

.feature-item:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: translateY(-5px);
}

.feature-icon {
    font-size: 2rem;
    margin-bottom: 0.5rem;
}

/* Focus Selection */
.focus-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1rem;
    max-width: 900px;
    margin: 0 auto;
}

.focus-card {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 20px;
    padding: 1.5rem;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    border: 3px solid transparent;
    position: relative;
    overflow: hidden;
}

.focus-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #667eea, #764ba2);
    transform: translateX(-100%);
    transition: transform 0.3s ease;
}

.focus-card:hover::before {
    transform: translateX(0);
}

.focus-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
}

.focus-card.selected {
    border-color: #667eea;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(255, 255, 255, 0.95));
}

.focus-icon {
    font-size: 2.5rem;
    margin-bottom: 1rem;
}

.focus-card h3 {
    color: #333;
    font-size: 1.3rem;
    margin-bottom: 0.5rem;
    font-weight: 600;
}

.focus-card p {
    color: #666;
    font-size: 0.95rem;
    margin: 0;
    line-height: 1.4;
}

/* Session Options */
.session-options {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    max-width: 600px;
    margin: 0 auto;
}

.session-option {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 20px;
    padding: 1.5rem;
    display: flex;
    align-items: center;
    gap: 1.5rem;
    cursor: pointer;
    transition: all 0.3s ease;
    border: 3px solid transparent;
}

.session-option:hover {
    transform: translateX(10px);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
}

.session-option.selected {
    border-color: #667eea;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(255, 255, 255, 0.95));
}

.session-visual {
    flex-shrink: 0;
}

.person-icon {
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, #667eea, #764ba2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: white;
}

.session-details h3 {
    color: #333;
    font-size: 1.4rem;
    margin-bottom: 0.5rem;
    font-weight: 600;
}

.session-details p {
    color: #666;
    margin-bottom: 1rem;
    line-height: 1.4;
}

.session-features {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
}

.feature-tag {
    background: rgba(102, 126, 234, 0.1);
    color: #667eea;
    padding: 0.25rem 0.75rem;
    border-radius: 15px;
    font-size: 0.8rem;
    font-weight: 500;
}

/* Therapist Matching */
.therapist-matching {
    max-width: 500px;
    margin: 0 auto;
    text-align: center;
}

.matching-animation {
    padding: 3rem 0;
}

.matching-spinner {
    position: relative;
    width: 100px;
    height: 100px;
    margin: 0 auto 2rem;
}

.spinner-ring {
    position: absolute;
    width: 100%;
    height: 100%;
    border: 4px solid rgba(255, 255, 255, 0.3);
    border-top: 4px solid white;
    border-radius: 50%;
    animation: spin 2s linear infinite;
}

.matching-icon {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 2rem;
    background: white;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.matching-text {
    color: white;
}

.matching-text h3 {
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
    font-weight: 600;
}

.matching-text p {
    font-size: 1rem;
    opacity: 0.8;
}

.therapist-result {
    animation: fadeInUp 0.6s ease;
}

.therapist-card {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 20px;
    padding: 2rem;
    display: flex;
    align-items: center;
    gap: 1.5rem;
    text-align: left;
}

.therapist-avatar {
    position: relative;
    width: 80px;
    height: 80px;
    border-radius: 50%;
    overflow: hidden;
    flex-shrink: 0;
}

.therapist-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.avatar-fallback {
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #667eea, #764ba2);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    color: white;
}

.therapist-info h3 {
    color: #333;
    font-size: 1.4rem;
    margin-bottom: 0.5rem;
    font-weight: 600;
}

.therapist-info p {
    color: #666;
    margin-bottom: 1rem;
}

.match-score {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.match-percentage {
    background: linear-gradient(135deg, #4CAF50, #45a049);
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 15px;
    font-size: 0.9rem;
    font-weight: 600;
    width: fit-content;
}

.match-reasons {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
}

.match-reasons span {
    background: rgba(102, 126, 234, 0.1);
    color: #667eea;
    padding: 0.25rem 0.5rem;
    border-radius: 10px;
    font-size: 0.8rem;
}

/* Setup Summary */
.setup-summary {
    max-width: 400px;
    margin: 0 auto 2rem;
}

.summary-card {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 20px;
    padding: 2rem;
    text-align: left;
}

.summary-card h3 {
    color: #333;
    margin-bottom: 1rem;
    font-size: 1.3rem;
    font-weight: 600;
}

.summary-items {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.summary-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.summary-label {
    color: #666;
    font-weight: 500;
}

.summary-value {
    color: #333;
    font-weight: 600;
}

.success-icon {
    font-size: 4rem;
    margin-bottom: 1rem;
    animation: bounce 1s ease infinite alternate;
}

/* Start Options */
.start-options {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    max-width: 400px;
    margin: 0 auto;
}

.start-button {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    padding: 1rem 2rem;
    border: none;
    border-radius: 25px;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
}

.start-button.primary {
    background: linear-gradient(135deg, #4CAF50, #45a049);
    color: white;
    box-shadow: 0 4px 20px rgba(76, 175, 80, 0.3);
}

.start-button.primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 30px rgba(76, 175, 80, 0.4);
}

.start-button.secondary {
    background: rgba(255, 255, 255, 0.9);
    color: #667eea;
    border: 2px solid rgba(102, 126, 234, 0.3);
}

.start-button.secondary:hover {
    background: white;
    border-color: #667eea;
    transform: translateY(-2px);
}

.button-icon {
    font-size: 1.2rem;
}

/* Navigation Controls */
.navigation-controls {
    position: sticky;
    bottom: 0;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-top: 1px solid rgba(255, 255, 255, 0.2);
    padding: 1rem 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.nav-btn {
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 20px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.nav-btn.primary {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
}

.nav-btn.primary:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
}

.nav-btn.secondary {
    background: transparent;
    color: #666;
    border: 2px solid #ddd;
}

.nav-btn.secondary:hover:not(:disabled) {
    border-color: #667eea;
    color: #667eea;
}

.nav-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none !important;
}

/* Quick Help */
.quick-help {
    position: fixed;
    bottom: 100px;
    right: 2rem;
    z-index: 1000;
}

.help-button {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: linear-gradient(135deg, #FF6B6B, #EE5A52);
    color: white;
    border: none;
    cursor: pointer;
    font-weight: 600;
    font-size: 1.2rem;
    box-shadow: 0 4px 20px rgba(255, 107, 107, 0.3);
    transition: all 0.3s ease;
}

.help-button:hover {
    transform: scale(1.1);
}

.help-tooltip {
    position: absolute;
    bottom: 60px;
    right: 0;
    background: rgba(0, 0, 0, 0.9);
    color: white;
    padding: 1rem;
    border-radius: 10px;
    width: 250px;
    font-size: 0.9rem;
    display: none;
    animation: fadeInUp 0.3s ease;
}

.help-tooltip::after {
    content: '';
    position: absolute;
    top: 100%;
    right: 20px;
    border: 8px solid transparent;
    border-top: 8px solid rgba(0, 0, 0, 0.9);
}

/* Crisis Banner */
.crisis-banner {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    background: linear-gradient(135deg, #FF6B6B, #EE5A52);
    color: white;
    padding: 0.5rem;
    text-align: center;
    font-size: 0.9rem;
    font-weight: 500;
    z-index: 200;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 1rem;
    transform: translateY(-100%);
    transition: transform 0.3s ease;
}

.crisis-banner.show {
    transform: translateY(0);
}

.crisis-link {
    color: white;
    text-decoration: none;
    background: rgba(255, 255, 255, 0.2);
    padding: 0.25rem 0.75rem;
    border-radius: 15px;
    font-weight: 600;
    transition: all 0.3s ease;
}

.crisis-link:hover {
    background: rgba(255, 255, 255, 0.3);
    color: white;
}

/* Animations */
@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateX(50px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes float {
    0%, 100% {
        transform: translateY(0px);
    }
    50% {
        transform: translateY(-20px);
    }
}

@keyframes spin {
    0% {
        transform: rotate(0deg);
    }
    100% {
        transform: rotate(360deg);
    }
}

@keyframes bounce {
    from {
        transform: scale(1);
    }
    to {
        transform: scale(1.1);
    }
}

/* Responsive Design */
@media (max-width: 768px) {
    .progress-header {
        padding: 1rem;
        flex-direction: column;
        gap: 1rem;
    }

    .progress-container {
        max-width: 100%;
    }

    .onboarding-content {
        padding: 1rem;
    }

    .step-header h1 {
        font-size: 2.2rem;
    }

    .step-header h2 {
        font-size: 1.8rem;
    }

    .focus-grid {
        grid-template-columns: 1fr;
    }

    .session-option {
        flex-direction: column;
        text-align: center;
        gap: 1rem;
    }

    .therapist-card {
        flex-direction: column;
        text-align: center;
    }

    .navigation-controls {
        padding: 1rem;
    }

    .quick-help {
        bottom: 80px;
        right: 1rem;
    }

    .start-options {
        gap: 0.75rem;
    }
}

/* Dark mode support */
@media (prefers-color-scheme: dark) {
    .focus-card,
    .session-option,
    .therapist-card,
    .summary-card {
        background: rgba(255, 255, 255, 0.1);
        color: white;
    }

    .focus-card h3,
    .session-details h3,
    .therapist-info h3,
    .summary-card h3 {
        color: white;
    }

    .focus-card p,
    .session-details p,
    .therapist-info p {
        color: rgba(255, 255, 255, 0.8);
    }
}
</style>
{% endblock %}

{% block scripts %}
<script>
// Modern Onboarding JavaScript
class ModernOnboarding {
    constructor() {
        this.currentStep = 1;
        this.totalSteps = 5;
        this.userPreferences = {
            focus: null,
            sessionType: null,
            therapist: null
        };
        this.init();
    }

    init() {
        this.bindEvents();
        this.updateProgress();
        this.showCrisisBannerIfNeeded();
    }

    bindEvents() {
        // Focus cards
        document.querySelectorAll('.focus-card').forEach(card => {
            card.addEventListener('click', (e) => this.selectFocus(e));
        });

        // Session options
        document.querySelectorAll('.session-option').forEach(option => {
            option.addEventListener('click', (e) => this.selectSession(e));
        });

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                this.nextStep();
            } else if (e.key === 'ArrowLeft') {
                e.preventDefault();
                this.previousStep();
            } else if (e.key === 'Escape') {
                this.skipOnboarding();
            }
        });

        // Auto-advance when selections are made
        this.setupAutoAdvance();
    }

    selectFocus(e) {
        const card = e.currentTarget;
        const focus = card.dataset.focus;

        // Remove previous selection
        document.querySelectorAll('.focus-card').forEach(c => c.classList.remove('selected'));
        
        // Add selection to clicked card
        card.classList.add('selected');
        
        // Store preference
        this.userPreferences.focus = focus;

        // Auto-advance after short delay
        setTimeout(() => {
            this.nextStep();
        }, 800);
    }

    selectSession(e) {
        const option = e.currentTarget;
        const session = option.dataset.session;

        // Remove previous selection
        document.querySelectorAll('.session-option').forEach(o => o.classList.remove('selected'));
        
        // Add selection to clicked option
        option.classList.add('selected');
        
        // Store preference
        this.userPreferences.sessionType = session;

        // Auto-advance after short delay
        setTimeout(() => {
            this.nextStep();
        }, 800);
    }

    setupAutoAdvance() {
        // Advanced to step 4 automatically triggers matching
        document.addEventListener('stepChanged', (e) => {
            if (e.detail.step === 4) {
                this.startTherapistMatching();
            }
        });
    }

    startTherapistMatching() {
        const matchingText = document.getElementById('matchingText');
        const matchingSubtext = document.getElementById('matchingSubtext');
        const matchingAnimation = document.getElementById('matchingAnimation');
        const therapistResult = document.getElementById('therapistResult');

        const stages = [
            { text: 'Analyzing your preferences...', subtext: 'Processing your focus area and session type' },
            { text: 'Finding compatible therapists...', subtext: 'Searching our database of AI specialists' },
            { text: 'Calculating match scores...', subtext: 'Using advanced algorithms to find your perfect match' },
            { text: 'Perfect match found!', subtext: 'We found an AI therapist that\'s 95% compatible with you' }
        ];

        let currentStage = 0;
        
        const updateStage = () => {
            if (currentStage < stages.length - 1) {
                matchingText.textContent = stages[currentStage].text;
                matchingSubtext.textContent = stages[currentStage].subtext;
                currentStage++;
                setTimeout(updateStage, 1500);
            } else {
                // Show final stage and then reveal result
                matchingText.textContent = stages[currentStage].text;
                matchingSubtext.textContent = stages[currentStage].subtext;
                
                setTimeout(() => {
                    matchingAnimation.style.display = 'none';
                    therapistResult.style.display = 'block';
                    this.customizeTherapistMatch();
                    
                    // Auto-advance to final step
                    setTimeout(() => {
                        this.nextStep();
                    }, 2000);
                }, 1000);
            }
        };

        updateStage();
    }

    customizeTherapistMatch() {
        const therapistName = document.getElementById('therapistName');
        const therapistSpecialty = document.getElementById('therapistSpecialty');
        const matchReasons = document.getElementById('matchReasons');

        // Customize based on user preferences
        const therapists = {
            anxiety: {
                name: 'Dr. Maya Chen',
                specialty: 'Cognitive Behavioral Therapy Specialist',
                reasons: ['Specializes in anxiety', 'CBT approach', 'Individual therapy expert']
            },
            depression: {
                name: 'Dr. James Wilson',
                specialty: 'Depression & Mood Disorder Expert',
                reasons: ['Depression specialist', 'DBT training', 'Supportive approach']
            },
            relationships: {
                name: 'Dr. Sarah Martinez',
                specialty: 'Relationship & Couples Counselor',
                reasons: ['Gottman Method trained', 'Couples specialist', 'Communication expert']
            },
            trauma: {
                name: 'Dr. Michael Thompson',
                specialty: 'Trauma & PTSD Specialist',
                reasons: ['EMDR certified', 'Trauma-informed', 'PTSD expert']
            },
            general: {
                name: 'Dr. Lisa Rodriguez',
                specialty: 'General Mental Health & Wellness',
                reasons: ['Holistic approach', 'Wellness focused', 'Preventive care']
            },
            crisis: {
                name: 'Dr. David Kim',
                specialty: 'Crisis Intervention Specialist',
                reasons: ['Crisis certified', '24/7 available', 'Emergency trained']
            }
        };

        const selectedTherapist = therapists[this.userPreferences.focus] || therapists.general;
        
        therapistName.textContent = selectedTherapist.name;
        therapistSpecialty.textContent = selectedTherapist.specialty;
        
        matchReasons.innerHTML = '';
        selectedTherapist.reasons.forEach(reason => {
            const span = document.createElement('span');
            span.textContent = reason;
            matchReasons.appendChild(span);
        });

        // Store therapist preference
        this.userPreferences.therapist = selectedTherapist.name;
    }

    nextStep() {
        if (this.currentStep < this.totalSteps) {
            this.currentStep++;
            this.showStep(this.currentStep);
        }
    }

    previousStep() {
        if (this.currentStep > 1) {
            this.currentStep--;
            this.showStep(this.currentStep);
        }
    }

    showStep(stepNumber) {
        // Hide all steps
        document.querySelectorAll('.step-panel').forEach(panel => {
            panel.classList.remove('active');
        });

        // Show current step
        const currentPanel = document.querySelector(`[data-step="${stepNumber}"]`);
        if (currentPanel) {
            currentPanel.classList.add('active');
        }

        // Update navigation
        this.updateNavigation();
        this.updateProgress();
        
        // Update summary if on final step
        if (stepNumber === 5) {
            this.updateSummary();
        }

        // Dispatch custom event
        document.dispatchEvent(new CustomEvent('stepChanged', {
            detail: { step: stepNumber }
        }));
    }

    updateNavigation() {
        const backButton = document.getElementById('backButton');
        const nextButton = document.getElementById('nextButton');

        backButton.disabled = this.currentStep === 1;
        
        if (this.currentStep === this.totalSteps) {
            nextButton.style.display = 'none';
        } else {
            nextButton.style.display = 'flex';
            
            // Update button text based on step
            const buttonTexts = {
                1: 'Get Started ‚Üí',
                2: 'Continue ‚Üí',
                3: 'Continue ‚Üí',
                4: 'Continue ‚Üí'
            };
            
            nextButton.querySelector('span').textContent = buttonTexts[this.currentStep] || 'Continue ‚Üí';
        }
    }

    updateProgress() {
        const progressFill = document.getElementById('progressFill');
        const stepCounter = document.getElementById('stepCounter');
        
        const percentage = (this.currentStep / this.totalSteps) * 100;
        progressFill.style.width = `${percentage}%`;
        stepCounter.textContent = `${this.currentStep} of ${this.totalSteps}`;
    }

    updateSummary() {
        const focusMap = {
            anxiety: 'Anxiety & Stress',
            depression: 'Depression & Mood',
            relationships: 'Relationships',
            trauma: 'Trauma & PTSD',
            general: 'General Wellness',
            crisis: 'Crisis Support'
        };

        const sessionMap = {
            individual: 'Individual Therapy',
            couples: 'Couples Therapy',
            group: 'Group Support'
        };

        document.getElementById('selectedFocus').textContent = 
            focusMap[this.userPreferences.focus] || 'Not selected';
        document.getElementById('selectedSession').textContent = 
            sessionMap[this.userPreferences.sessionType] || 'Not selected';
        document.getElementById('selectedTherapist').textContent = 
            this.userPreferences.therapist || 'Not assigned';
    }

    showCrisisBannerIfNeeded() {
        // Show crisis banner if user selected crisis or if it's after hours
        const hour = new Date().getHours();
        const isAfterHours = hour < 8 || hour > 18;
        
        if (this.userPreferences.focus === 'crisis' || isAfterHours) {
            const banner = document.querySelector('.crisis-banner');
            banner.classList.add('show');
        }
    }

    skipOnboarding() {
        if (confirm('Are you sure you want to skip the setup? You can always complete it later from your settings.')) {
            this.savePreferences();
            window.location.href = '/';
        }
    }

    savePreferences() {
        // Save user preferences to localStorage
        localStorage.setItem('mindmend_onboarding_completed', 'true');
        localStorage.setItem('mindmend_user_preferences', JSON.stringify(this.userPreferences));
        
        // Send to backend if user is logged in
        if (window.user_id) {
            fetch('/api/user/preferences', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(this.userPreferences)
            }).catch(err => console.warn('Failed to save preferences:', err));
        }
    }

    complete() {
        this.savePreferences();
        
        // Show success message
        this.showSuccessMessage();
    }

    showSuccessMessage() {
        const content = document.getElementById('onboardingContent');
        content.innerHTML = `
            <div class="completion-screen">
                <div class="success-animation">
                    <div class="checkmark">‚úì</div>
                </div>
                <h2>Welcome to MindMend!</h2>
                <p>Your personalized mental health journey starts now.</p>
                <div class="completion-actions">
                    <button class="start-button primary" onclick="window.location.href='/individual'">
                        <span class="button-icon">üöÄ</span>
                        Start My First Session
                    </button>
                </div>
            </div>
        `;

        // Hide navigation
        document.querySelector('.navigation-controls').style.display = 'none';
    }
}

// Global functions
function skipOnboarding() {
    onboarding.skipOnboarding();
}

function nextStep() {
    onboarding.nextStep();
}

function previousStep() {
    onboarding.previousStep();
}

function startFirstSession() {
    onboarding.savePreferences();
    window.location.href = '/individual';
}

function takeTour() {
    onboarding.savePreferences();
    window.location.href = '/?tour=true';
}

function toggleHelp() {
    const tooltip = document.getElementById('helpTooltip');
    tooltip.style.display = tooltip.style.display === 'block' ? 'none' : 'block';
}

function showCrisisModal() {
    // Implement crisis modal
    alert('Crisis support coming soon. For immediate help, call 988.');
}

// Initialize when DOM is loaded
let onboarding;
document.addEventListener('DOMContentLoaded', function() {
    onboarding = new ModernOnboarding();
    
    // Auto-focus on first interactive element
    const firstFocusCard = document.querySelector('.focus-card');
    if (firstFocusCard && !window.matchMedia('(max-width: 768px)').matches) {
        firstFocusCard.focus();
    }
});

// Analytics tracking (placeholder)
function trackOnboardingEvent(event, data = {}) {
    if (window.gtag) {
        gtag('event', event, {
            event_category: 'onboarding',
            ...data
        });
    }
}
</script>
{% endblock %}