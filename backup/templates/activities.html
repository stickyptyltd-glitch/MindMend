{% extends "base.html" %}

{% block title %}Therapeutic Activities - Mind Mend{% endblock %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-12">
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h2 class="mb-0"><i class="fas fa-tasks me-2"></i>Therapeutic Activities & Exercises</h2>
                </div>
                <div class="card-body">
                    <p class="lead">Explore evidence-based activities designed to support your mental health journey.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Activity Categories -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="btn-group flex-wrap" role="group">
                <button class="btn btn-outline-primary active" onclick="filterActivities('all')">All Activities</button>
                <button class="btn btn-outline-primary" onclick="filterActivities('mindfulness')">Mindfulness</button>
                <button class="btn btn-outline-primary" onclick="filterActivities('cognitive')">Cognitive</button>
                <button class="btn btn-outline-primary" onclick="filterActivities('behavioral')">Behavioral</button>
                <button class="btn btn-outline-primary" onclick="filterActivities('emotional')">Emotional</button>
                <button class="btn btn-outline-primary" onclick="filterActivities('interpersonal')">Interpersonal</button>
                <button class="btn btn-outline-primary" onclick="filterActivities('creative')">Creative</button>
                <button class="btn btn-outline-primary" onclick="filterActivities('somatic')">Body-Based</button>
            </div>
        </div>
    </div>

    <!-- Activities Grid -->
    <div class="row" id="activitiesGrid">
        <!-- Mindfulness Activities -->
        <div class="col-md-6 col-lg-4 mb-4 activity-card" data-category="mindfulness">
            <div class="card h-100">
                <div class="card-header bg-info">
                    <h5 class="mb-0 text-dark"><i class="fas fa-brain me-2"></i>Body Scan Meditation</h5>
                </div>
                <div class="card-body">
                    <p><strong>Duration:</strong> 15-20 minutes</p>
                    <p>Systematically focus on different parts of your body, noticing sensations without judgment.</p>
                    <div class="mt-3">
                        <button class="btn btn-sm btn-primary" onclick="startActivity('body-scan')">
                            <i class="fas fa-play me-1"></i>Start Activity
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6 col-lg-4 mb-4 activity-card" data-category="mindfulness">
            <div class="card h-100">
                <div class="card-header bg-info">
                    <h5 class="mb-0 text-dark"><i class="fas fa-hand-holding-heart me-2"></i>5-4-3-2-1 Grounding</h5>
                </div>
                <div class="card-body">
                    <p><strong>Duration:</strong> 5 minutes</p>
                    <p>Use your senses to ground yourself in the present moment and reduce anxiety.</p>
                    <div class="mt-3">
                        <button class="btn btn-sm btn-primary" onclick="startActivity('grounding')">
                            <i class="fas fa-play me-1"></i>Start Activity
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Cognitive Activities -->
        <div class="col-md-6 col-lg-4 mb-4 activity-card" data-category="cognitive">
            <div class="card h-100">
                <div class="card-header bg-warning">
                    <h5 class="mb-0 text-dark"><i class="fas fa-book me-2"></i>Thought Record Journal</h5>
                </div>
                <div class="card-body">
                    <p><strong>Duration:</strong> 20 minutes</p>
                    <p>Identify and challenge negative thought patterns using CBT techniques.</p>
                    <div class="mt-3">
                        <button class="btn btn-sm btn-primary" onclick="startActivity('thought-record')">
                            <i class="fas fa-play me-1"></i>Start Activity
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6 col-lg-4 mb-4 activity-card" data-category="cognitive">
            <div class="card h-100">
                <div class="card-header bg-warning">
                    <h5 class="mb-0 text-dark"><i class="fas fa-heart me-2"></i>Gratitude Mapping</h5>
                </div>
                <div class="card-body">
                    <p><strong>Duration:</strong> 15 minutes</p>
                    <p>Create a visual map of things you appreciate to shift focus to the positive.</p>
                    <div class="mt-3">
                        <button class="btn btn-sm btn-primary" onclick="startActivity('gratitude-map')">
                            <i class="fas fa-play me-1"></i>Start Activity
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Behavioral Activities -->
        <div class="col-md-6 col-lg-4 mb-4 activity-card" data-category="behavioral">
            <div class="card h-100">
                <div class="card-header bg-success">
                    <h5 class="mb-0 text-dark"><i class="fas fa-calendar-check me-2"></i>Activity Scheduling</h5>
                </div>
                <div class="card-body">
                    <p><strong>Duration:</strong> 15 minutes daily</p>
                    <p>Plan enjoyable and meaningful activities to combat depression and build routine.</p>
                    <div class="mt-3">
                        <button class="btn btn-sm btn-primary" onclick="startActivity('activity-schedule')">
                            <i class="fas fa-play me-1"></i>Start Activity
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Emotional Activities -->
        <div class="col-md-6 col-lg-4 mb-4 activity-card" data-category="emotional">
            <div class="card h-100">
                <div class="card-header bg-danger">
                    <h5 class="mb-0 text-dark"><i class="fas fa-palette me-2"></i>Emotion Wheel Check-In</h5>
                </div>
                <div class="card-body">
                    <p><strong>Duration:</strong> 10 minutes</p>
                    <p>Identify and name complex emotions to improve emotional literacy.</p>
                    <div class="mt-3">
                        <button class="btn btn-sm btn-primary" onclick="startActivity('emotion-wheel')">
                            <i class="fas fa-play me-1"></i>Start Activity
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Interpersonal Activities -->
        <div class="col-md-6 col-lg-4 mb-4 activity-card" data-category="interpersonal">
            <div class="card h-100">
                <div class="card-header bg-primary">
                    <h5 class="mb-0"><i class="fas fa-users me-2"></i>Active Listening Practice</h5>
                </div>
                <div class="card-body">
                    <p><strong>Duration:</strong> 20 minutes</p>
                    <p>Improve communication through focused listening exercises with a partner.</p>
                    <div class="mt-3">
                        <button class="btn btn-sm btn-primary" onclick="startActivity('active-listening')">
                            <i class="fas fa-play me-1"></i>Start Activity
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Creative Activities -->
        <div class="col-md-6 col-lg-4 mb-4 activity-card" data-category="creative">
            <div class="card h-100">
                <div class="card-header bg-info">
                    <h5 class="mb-0 text-dark"><i class="fas fa-paint-brush me-2"></i>Art Therapy Expression</h5>
                </div>
                <div class="card-body">
                    <p><strong>Duration:</strong> 30-45 minutes</p>
                    <p>Express emotions through creative art without judgment.</p>
                    <div class="mt-3">
                        <button class="btn btn-sm btn-primary" onclick="startActivity('art-therapy')">
                            <i class="fas fa-play me-1"></i>Start Activity
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Somatic Activities -->
        <div class="col-md-6 col-lg-4 mb-4 activity-card" data-category="somatic">
            <div class="card h-100">
                <div class="card-header bg-success">
                    <h5 class="mb-0 text-dark"><i class="fas fa-spa me-2"></i>Progressive Muscle Relaxation</h5>
                </div>
                <div class="card-body">
                    <p><strong>Duration:</strong> 20 minutes</p>
                    <p>Systematically tense and relax muscle groups to reduce physical tension.</p>
                    <div class="mt-3">
                        <button class="btn btn-sm btn-primary" onclick="startActivity('pmr')">
                            <i class="fas fa-play me-1"></i>Start Activity
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Personalized Recommendations -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-primary">
                    <h4 class="mb-0"><i class="fas fa-star me-2"></i>Personalized Recommendations</h4>
                </div>
                <div class="card-body">
                    <p>Based on your recent sessions, we recommend these activities:</p>
                    <div id="recommendations" class="row">
                        <!-- Recommendations will be loaded here -->
                    </div>
                    <button class="btn btn-primary mt-3" onclick="getPersonalizedPlan()">
                        <i class="fas fa-sync me-2"></i>Get New Recommendations
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Filter activities by category
function filterActivities(category) {
    const cards = document.querySelectorAll('.activity-card');
    const buttons = document.querySelectorAll('.btn-group button');
    
    // Update active button
    buttons.forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    
    // Show/hide cards
    cards.forEach(card => {
        if (category === 'all' || card.dataset.category === category) {
            card.style.display = 'block';
        } else {
            card.style.display = 'none';
        }
    });
}

// Start an activity
async function startActivity(activityType) {
    try {
        const response = await fetch('/api/start_activity', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ activity_type: activityType })
        });
        
        const data = await response.json();
        if (data.redirect) {
            window.location.href = data.redirect;
        }
    } catch (error) {
        console.error('Error starting activity:', error);
    }
}

// Get personalized activity recommendations
async function getPersonalizedPlan() {
    try {
        const response = await fetch('/api/personalized_activities');
        const data = await response.json();
        
        const recommendationsDiv = document.getElementById('recommendations');
        recommendationsDiv.innerHTML = '';
        
        data.activities.forEach(activity => {
            const card = `
                <div class="col-md-4 mb-3">
                    <div class="card">
                        <div class="card-body">
                            <h6>${activity.name}</h6>
                            <p class="small">${activity.description}</p>
                            <button class="btn btn-sm btn-primary" onclick="startActivity('${activity.id}')">
                                Start
                            </button>
                        </div>
                    </div>
                </div>
            `;
            recommendationsDiv.innerHTML += card;
        });
    } catch (error) {
        console.error('Error getting recommendations:', error);
    }
}

// Load recommendations on page load
document.addEventListener('DOMContentLoaded', getPersonalizedPlan);
</script>
{% endblock %}